# Базы данных и всё, что с ними едят

Подключение к базам данных задаётся в конфигурационном файле [database.php](https://github.com/DavidaaWoW/LaravelCarServiceApplication/blob/main/config/database.php), а также в файле .env

В файле database.php задаётся БД по умолчанию (default), а также вводятся данные для подключения к каждой из необходимых БД, и отдельно для Redis

**Важно, что вместо localhost, в качестве хоста нужно указывать название контейнера**

## [Миграции](https://laravel.com/docs/9.x/migrations)

В папке [migrations](https://github.com/DavidaaWoW/LaravelCarServiceApplication/tree/main/database/migrations) создаются миграции всех таблиц будущей базы данных. 

*Для работы миграций внутри docker container-ов необходимо установить в php расширение mysql-pdo, а также включить внутреннее его использование в файле глобальной конфигурации php.ini*

*Миграции выполняются в apache контейнере, из корневой директории проекта, командой* **php artisan migrate**

В файлах миграций отражена внутренняя структура sql таблиц. Первые два файла были сгенерированы автоматически. В проекте также присутствует две инстанции миграции пользователей - одна базовая, вторая уже с добавленными полями для файлов.

Поле remember_token отвечает за сохранение токена для запоминания пользователей. Весь процесс доступен "из коробки" и практически не требует участия разработчика.

Поле timestamps отвечает за создание двух полей: 

- дата создания записи
- дата обновления записи *значение будет автоматически будет обновляться при каждом обновлении любого поля*

Поле foreignId отвечает за установку внешнего ключа, методом constrained привязываем название таблицы

## [Сидеры](https://laravel.com/docs/9.x/seeding)

В файле [DatabaseSeeder](https://github.com/DavidaaWoW/LaravelCarServiceApplication/blob/main/database/seeders/DatabaseSeeder.php) отражены действия сидеров.

Сидеры отвечают за ручное заполнение базы данными.

Внутри единственного метода run() статически вызываем у таблицы метод insert, внутрь которого передаём массив со всеми необходимыми данными

## [Фабрики](https://laravel.com/docs/9.x/eloquent-factories)

В файле [CarFactory](https://github.com/DavidaaWoW/LaravelCarServiceApplication/blob/main/database/factories/CarFactory.php) отражена фабрика автомобилей, которая в дальнейшем будет использоваться в контроллере статистике.

Фабрики в laravel используются для автоматического заполнения базы данных случайными данными. Для работы фабрик, laravel использует библиотеку [FakerPhp](https://fakerphp.github.io/)

В методе definition() возвращаем массив, в котором описываем способ генерации каждого поля, обращаясь к методу fake(). 

Так, метод words() будет генерировать случайные слова, количество передаётся в первом параметре, второй булевый параметр отвечает за преобразование их в строку.

Метод imageUrl будет выдавать ссылки на реальные изображения. Внутрь передаются параметры размеров, категория и буль, отвечающий за рандомизацию вывода

Метод numberBetween просто генерирует число в выбранном диапазоне.