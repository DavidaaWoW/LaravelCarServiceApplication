# Контроллеры

Контроллеры отвечают за корректную работу всех view приложения. 
В контроллерах указывается весь необходимый функционал, перед непосредственным отображением страницы

# Аутентификация

За работу аутентификации отвечают [RegistrationController](https://github.com/DavidaaWoW/LaravelCarServiceApplication/blob/main/app/Http/Controllers/RegistrationController.php) и [LoginController](https://github.com/DavidaaWoW/LaravelCarServiceApplication/blob/main/app/Http/Controllers/LoginController.php)

В контроллере регистрации присутствует единственный метод save, который в параметрах получает входящий запрос

*В laravel контроллерах любой метод, помимо явно передаваемых параметров, может получать также параметр типа ```Request```, в котором находится вся информация по входящему запросу*

Изначально, проверяется текущий статус аутентификации - если пользователь уже аутентифицирован, то ему не нужен доступ к страницам аутентификации.

Далее, происходит автоматическая [валидация](https://laravel.com/docs/9.x/validation#main-content) полей почты и пароля. Так, почта обязательна для заполнения, должна быть валидным электронным адресом, а также, должна быть уникальной в пределах БД пользователей. А пароль, просто является обязательным полем.

В случае, если валидация не проходит, выполнение метода прерывается, а запрос возвращается назад, с параметрами ошибок, которые далее могут быть обработаны в ```Blade``` шаблонах.

Следующим шагом добавляем к массиву поле ```id```, которое генерируем встроенной в PHP функцией.

После чего создаём пользователя, передавая в статический метод create массив параметров.

Если пользователь создался, то сразу же выполняем вход, а также передаём дефолтный набор параметров в БД редиса. После чего выполняем редирект в профиль пользователя.

Иначе опять переходим на текущую страницу, передавая ошибки.


В контроллере логина получаем лишь необходимые поля из запроса, методом ```only()```, после чего также выполняем попытку входа.

# Профиль

В контроллере профиля присутствует 4 метода.

~~Про методы setLan и setTheme будет рассказано в соответствующих разделах~~

Метод ```uploadPDF``` получает из запроса всю необходимую информациб о файле. Далее, файл читается в бинарном виде, после чего происходит поиск пользователя и в данные добавляется сам файл и вся информация по нему. После чего происходит редирект

Метод ```downloadPDF``` использует [потоковую загрузку](https://laravel.com/docs/9.x/responses#streamed-downloads), позволяя пользователю загрузить файл со своими правами

# Бренды

Первые два метода возвращают ```view```, в зависимости от прав пользователя. Вторым параметром передаётся массив данных, в данном случае все найденные бренды, из таблицы ```Brand```, в дальнейшем, данные используются в ```Blade``` шаблонах.

Следом реализуются основные методы ```CRUD api```.

# Автомобили

Также, как и в случае брендов, первые два метода возвращают ```view``` с данными массива автомобилей. Только в данном случае, одним из способов, методы получают ```id``` бренда, именно по которому происходит фильтрация машин, методом ```where()```

Методы CRUD api также почти не отличаются от аналогичных в брендах

# Статистика
~~Про контроллер статистики будет рассказано в соответствующем разделе~~
