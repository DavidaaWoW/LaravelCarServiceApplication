# Административная часть интернет-ресурса

Для администрирования интернет-ресурса были созданы три шаблона, отвечающие за  редактирование брендов, автомобилей и просмотр статистики.

Вся административная часть защищена встроенными в apache механизмами: htaccess и htpasswd, которые непосредственно к laravel не имеют отношения.

## Шаблоны

В целом, шаблоны администрирования работают по принципу, аналогичному обычному просмотру брендов и автомобилей - внутрь передаётся массив, по которому происходит итерация циклом foreach ```@foreach ($brands as $brand)```.
Однако, помимо просмотра, администратор может также совершать базовый CRUD действия над моделями, отправляя запросы к [контроллерам](https://github.com/DavidaaWoW/LaravelCarServiceApplication/tree/main/app/Http/Controllers).

Действия ```create``` и ```update``` должны получать откуда-то данные. В данном случае, они их получают из форм, которые находятся в модальных окнах. Для реализации модальных окон, в проекте используется [bootstrap modal](https://getbootstrap.com/docs/4.0/components/modal/).

В то же время, контроллерам необходимо понимать, какой бренд, или автомобиль нужно изменять, а в условиях, когда вызывается модальное окно, находящееся вне цикла, напрямую получить доступ к текущему итерируемому объекту невозможно.

Для решения данной задачи, в модальных окнах был создан скрытый input, с соответствующим ```id```
```
<input type="hidden" id="hidden" name="id">
```
После чего, была написана функция на библиотеке [JQuery](https://jquery.com/), которая при запуске модального окна, отслеживает объект, из которого оно было вызвано, затем, вставляяет значение в скрытый input.

```
    $('#staticBackdrop').on('show.bs.modal', function(event) {
        let brandId = $(event.relatedTarget).data('brandid')
        $(this).find('#hidden').val(brandId)
    })
```

## Статистика

Статистика состоит из двух частей - **генерации случайного количества автомобилей** и **графиков**.

Для статистики был создан отдельный [контроллер](https://github.com/DavidaaWoW/LaravelCarServiceApplication/blob/main/app/Http/Controllers/StatisticsController.php)

- Генерация случайных данных

Генерация случайного количества происходит в методе ```generateRand```, который сначала вытаскивает из запроса нужное количество автомобилей, после чего, статически вызывает у фабрики, сначала метод ```count```, в параметрах которого указывается точное число генерации, а затем вызывается метод ```create```, который и непосредственно генерирует объекты, и сразу же сохраняет их в БД.

В конце, вызывается локальный метод ```makeChart```, для обновления данных в графиках

- Графики

Для генерации графиков используется [портирование](https://github.com/akaunting/laravel-apexcharts) Apexcharts в laravel.

Все необходимые графики генерируются в методе ```makeChart```. Изначально создаются новые объекты, класса ```Chart```, указывается тип графика, его размеры, названия столбцов, а также сами данные.

После чего все объекты графиков просто передаются внутрь шаблонов в виде переменных.

Для приложения были созданы три различных вида графиков:

+ Первый - это столбчатая диаграмма сравнивающая количество автомобилей у каждого из брендов.

+ Второй - линейная диаграмма, сравнивающая количество брендов, автомобилей и пользователей в приложении.

+ Третий - отражающий по сути ту же статистику, что и второй, только в виде круговой диаграммы.

Далее, уже на странице статистики, они просто выводятся в виде обычных динамических переменных в шаблонах, идёт последовательное обращение к методам ```container``` и ```script```.